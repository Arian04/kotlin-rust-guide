<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Borrowing and Ownership - A guide to Rust for Kotlin developers</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="This book should help experienced Kotlin developers to quickly get up to speed with Rust">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="ferris.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="intro.html">Introduction</a></li><li class="chapter-item expanded "><a href="basics.html"><strong aria-hidden="true">1.</strong> Basics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="basics_syntax.html"><strong aria-hidden="true">1.1.</strong> Syntax differences</a></li><li class="chapter-item expanded "><a href="macros.html"><strong aria-hidden="true">1.2.</strong> Macros</a></li><li class="chapter-item expanded "><a href="basics_primitives.html"><strong aria-hidden="true">1.3.</strong> Primitives</a></li><li class="chapter-item expanded "><a href="basics_error.html"><strong aria-hidden="true">1.4.</strong> Error Handling</a></li></ol></li><li class="chapter-item expanded "><a href="types.html"><strong aria-hidden="true">2.</strong> Types and variables</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="types_mutability.html"><strong aria-hidden="true">2.1.</strong> Mutability</a></li><li class="chapter-item expanded "><a href="types_strings.html"><strong aria-hidden="true">2.2.</strong> Strings</a></li><li class="chapter-item expanded "><a href="types_commmon.html"><strong aria-hidden="true">2.3.</strong> Common types</a></li><li class="chapter-item expanded "><a href="types_constants.html"><strong aria-hidden="true">2.4.</strong> Constants</a></li></ol></li><li class="chapter-item expanded "><a href="references.html"><strong aria-hidden="true">3.</strong> References</a></li><li class="chapter-item expanded "><a href="borrowing.html" class="active"><strong aria-hidden="true">4.</strong> Borrowing and Ownership</a></li><li class="chapter-item expanded "><a href="classes.html"><strong aria-hidden="true">5.</strong> Classes, or the lack there of</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="classes_deriving.html"><strong aria-hidden="true">5.1.</strong> Deriving and implementing</a></li><li class="chapter-item expanded "><a href="classes_default.html"><strong aria-hidden="true">5.2.</strong> Default</a></li></ol></li><li class="chapter-item expanded "><a href="methods.html"><strong aria-hidden="true">6.</strong> Methods</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="methods_self.html"><strong aria-hidden="true">6.1.</strong> this/self</a></li><li class="chapter-item expanded "><a href="methods_functional.html"><strong aria-hidden="true">6.2.</strong> Functional Programming</a></li></ol></li><li class="chapter-item expanded "><a href="modules.html"><strong aria-hidden="true">7.</strong> Modules</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="modules_directories.html"><strong aria-hidden="true">7.1.</strong> Directories</a></li></ol></li><li class="chapter-item expanded "><a href="crates.html"><strong aria-hidden="true">8.</strong> Crates</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="crates_adding.html"><strong aria-hidden="true">8.1.</strong> Adding crates</a></li><li class="chapter-item expanded "><a href="crates_standard.html"><strong aria-hidden="true">8.2.</strong> Not in standard</a></li><li class="chapter-item expanded "><a href="crates_common.html"><strong aria-hidden="true">8.3.</strong> Common crates</a></li></ol></li><li class="chapter-item expanded "><a href="result.html"><strong aria-hidden="true">9.</strong> Result, Option and Exceptions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="result_exception.html"><strong aria-hidden="true">9.1.</strong> Result and exceptions</a></li><li class="chapter-item expanded "><a href="result_option.html"><strong aria-hidden="true">9.2.</strong> Option and nulls</a></li></ol></li><li class="chapter-item expanded "><a href="concurrency.html"><strong aria-hidden="true">10.</strong> Concurrency</a></li><li class="chapter-item expanded "><a href="testing.html"><strong aria-hidden="true">11.</strong> Testing</a></li><li class="chapter-item expanded "><a href="cargo.html"><strong aria-hidden="true">12.</strong> Cargo</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cargo_tools.html"><strong aria-hidden="true">12.1.</strong> Tools</a></li></ol></li><li class="chapter-item expanded "><a href="enums.html"><strong aria-hidden="true">13.</strong> Enums</a></li><li class="chapter-item expanded "><a href="tips.html"><strong aria-hidden="true">14.</strong> Tips and tricks</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tips_iflet.html"><strong aria-hidden="true">14.1.</strong> if let</a></li><li class="chapter-item expanded "><a href="tips_refcount.html"><strong aria-hidden="true">14.2.</strong> Reference counting</a></li><li class="chapter-item expanded "><a href="tips_strings.html"><strong aria-hidden="true">14.3.</strong> Converting strings</a></li><li class="chapter-item expanded "><a href="tips_intmut.html"><strong aria-hidden="true">14.4.</strong> Interior mutability</a></li><li class="chapter-item expanded "><a href="tips_enumiter.html"><strong aria-hidden="true">14.5.</strong> Indexed iteration</a></li><li class="chapter-item expanded "><a href="tips_formatting.html"><strong aria-hidden="true">14.6.</strong> Formatting strings</a></li><li class="chapter-item expanded "><a href="tips_crates.html"><strong aria-hidden="true">14.7.</strong> For crates</a></li></ol></li><li class="chapter-item expanded "><a href="errors.html"><strong aria-hidden="true">15.</strong> Common bugs/issues</a></li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">16.</strong> Architecture</a></li><li class="chapter-item expanded affix "><a href="resources.html">Resources</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">A guide to Rust for Kotlin developers</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="borrowing-and-ownership"><a class="header" href="#borrowing-and-ownership">Borrowing and Ownership</a></h1>
<p>In Kotlin a variable exists, and is available, while in it’s scope. A global static variable is always available but a variable created in a method (unless returned) only exists during that instance of the methods execution. Rust is basically the same and generally you’ll be able to write code without having to think about the borrowing system, but sometimes you will have to deal with it.</p>
<p>This will not compile as <code>bar</code> has taken ownership of the data in <code>foo</code> and so <code>foo</code> can no longer be used:</p>
<pre><code class="language-rust does_not_compile ignore">let foo = String::from(&quot;Hello&quot;); 
let bar = foo;
println!(&quot;{}&quot;, foo);
</code></pre>
<p>This will compile however as numbers have Copy implemented for them and so num2 automatically makes a copy of num1s data:</p>
<pre><pre class="playground"><code class="language-rust edition2018">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let num1 = 54;
let num2 = num1; 
println!(&quot;{}&quot;, num1);
<span class="boring">}
</span></code></pre></pre>
<p>but this can be replicated for the string example by doing:</p>
<pre><pre class="playground"><code class="language-rust edition2018">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let foo = String::from(&quot;Hello&quot;); 
let bar = foo.clone();
println!(&quot;{}&quot;, foo);
<span class="boring">}
</span></code></pre></pre>
<p>This will only work when the type implemented Clone. Not all types support Clone as it may be impossible to copy it’s data, for example with network streams.
Ownership and borrowing apply to all methods:</p>
<pre><pre class="playground"><code class="language-rust edition2018">fn main() {
	let a = String::from(&quot;Hello&quot;); 
	let b = return_param(a);
	let c = length(b);
    println!(&quot;{}&quot;, c);
}

fn return_param(param: String) -&gt; String { 
	return param;
}

fn length(param: String) -&gt; usize {
	return param.len();
}
</code></pre></pre>
<p>When main is executed both <code>a</code> and <code>b</code> are lost, length takes ownership of the string and it is dropped at the end of length, to keep <code>b</code> in memory either of the following changes could be made:</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">fn main() {
</span><span class="boring">let str = String::from(&quot;test&quot;);
</span><span class="boring">let _ref_len = length_ref(&amp;str);
</span><span class="boring">let (nstr, len) = length(str);
</span><span class="boring">println!(&quot;({},{})&quot;, nstr, len);
</span><span class="boring">}
</span>
fn length_ref(param: &amp;String) -&gt; usize {
	return param.len(); //not dereferenced:
	//because param is a reference len() will return it's result as a reference
	//and because usize implements Copy it will be automatically dereferenced
}

//or

fn length(param: String) -&gt; (String, usize) { 
	let len = param.len();
	return (param, len);
}
</code></pre></pre>
<p>References are just pointers and so don’t take ownership but instead the value is borrowed, there are some rules around this for example only one mutable reference can exist at once. Because of this a potential helpful way to think about this is shared vs unique, you can as many read only references as you want shared around but when writeable only a single unique reference can exist (to avoid race conditions, etc).</p>
<p>Rust supports generics like Kotlin and they are expressed like this: <code>Vec&lt;Item&gt;</code>, occasionally you might see <code>Vec&lt;&amp;'a Item&gt;</code> the <code>'a</code> is a lifetime notation and these are used to guide the compiler as to how long references will be alive. The lifetime name doesn’t matter but the standard names are <code>'a</code>, <code>'b</code> and <code>'c</code>, except for <code>'static</code> which means the variable must always be available, i.e. a hardcoded value.</p>
<p>If a parameter has the lifetime <code>a</code> and a result also has the lifetime <code>a</code> like this:</p>
<pre><pre class="playground"><code class="language-rust edition2018">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Foo {
	contents: String
}

impl Foo {
	//like with generics the lifetime has to specified in advance with &lt;&gt;
	fn get_first&lt;'a&gt;(&amp;'a self) -&gt; &amp;'a str {
		&amp;self.contents[0..1]
	}
}
<span class="boring">}
</span></code></pre></pre>
<p>then this is saying the instance of <code>Foo</code> must live as long as the reference returned by <code>get_first</code>.</p>
<p>However, in the example above the lifetimes aren't because the method has one parameter that is a reference and one result that is a reference and they share the same lifetime, so Rust will automatically assume the lifetime.</p>
<p>This would not compile:</p>
<pre><code class="language-rust does_not_compile ignore"><span class="boring">struct Foo {	contents: String }
</span>
<span class="boring">impl Foo {
</span><span class="boring">fn get_first&lt;'a&gt;(&amp;'a self) -&gt; &amp;'a str {&amp;self.contents[0..1]}
</span><span class="boring">}
</span>
fn main() {
	let result = get_char();
}

fn get_char() -&gt; &amp;str {
	let foo = Foo { contents: String::from(&quot;example&quot;) };
	let chr = foo.get_first();
	return chr;
}
</code></pre>
<p>as there's no lifetime on the result of <code>get_char</code> and there can't be as <code>foo</code> is dropped at the end of <code>get_char</code> and so <code>chr</code> would be pointing to an invalid section of memory.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="references.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="classes.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="references.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="classes.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="ferris.js"></script>
    </body>
</html>
